---
const { inputID, btnID, newsletterClass, newsletterBtn } = Astro.props;
import TheModal from "./TheModal.astro";

if (Astro.request.method === "POST") {

  async function formSubmit() {
  try {
    const data = await Astro.request.formData();
    const email = data.get("email");
    const response = await fetch('https://a.klaviyo.com/client/subscriptions/?company_id=Rsd4T6', {
        method: 'POST',
        headers: {revision: '2024-02-15', 'content-type': 'application/json'},
        body: JSON.stringify({
            data: {
            type: 'subscription',
            attributes: {
                custom_source: 'Nav signup form',
                profile: {
                data: {
                    type: 'profile',
                    id: '01GDDKASAP8TKDDA2GRZDSVP4H',
                    attributes: {
                    email: email,
                    properties: {newKey: 'New Value'},
                    meta: {
                        patch_properties: {append: {newKey: 'New Value'}, unappend: {newKey: 'New Value'}, unset: 'skus'}
                    }
                    }
                }
                }
            },
            relationships: {list: {data: {type: 'list', id: 'WJRt59'}}}
            }
        })
    });
    console.log('status code: ', response.status); // 👉️ 200
    const json = await response.json();
    // alert("Please check your email to confirm your subscription");
    console.log(json);
  } catch (error) {
    console.log(error);
  }
}

formSubmit();


  // try {
  //   const data = await Astro.request.formData();
  //   const email = data.get("email");
  //   // Do something with the data
  //   fetch('https://a.klaviyo.com/client/subscriptions/?company_id=UKL5uG', {
  //       method: 'POST',
  //       headers: {revision: '2023-12-15', 'content-type': 'application/json'},
  //       body: JSON.stringify({
  //           data: {
  //           type: 'subscription',
  //           attributes: {
  //               custom_source: 'Nav signup form',
  //               profile: {
  //               data: {
  //                   type: 'profile',
  //                   id: '01GDDKASAP8TKDDA2GRZDSVP4H',
  //                   attributes: {
  //                   email: email,
  //                   properties: {newKey: 'New Value'},
  //                   meta: {
  //                       patch_properties: {append: {newKey: 'New Value'}, unappend: {newKey: 'New Value'}, unset: 'skus'}
  //                   }
  //                   }
  //               }
  //               }
  //           },
  //           relationships: {list: {data: {type: 'list', id: 'WLqZCg'}}}
  //           }
  //       })
  //   })
  //   .then(response => response.json())
  //   .then(() => alert("Thank you for your submission"))    
  //   .catch(err => console.error(err));
  //   console.log(data)
  // } catch (error) {
  //   if (error instanceof Error) {
  //     console.error(error.message);
  //   }
  // }
}
---
<form method="POST" class="w-100">
    <div class="input-group my-2 px-0">
      <input id={inputID} type="email" name="email" class:list={["form-control rounded-start-2", newsletterClass]} placeholder="name@example.com" aria-label="Sign up for our newsletter" aria-describedby="A form to subscribe to Prince Collection newsletter" required>
      <button id={btnID} class:list={["btn rounded-0 fw-bold rounded-end-2", newsletterBtn]}
      >I'm in!</button>
    </div>
</form>

<!-- <TheModal modalTitle="Join Our Newsletter" modalId="thankYou" modalStyles="bg-dark text-light min-vh-500 rounded-4" modalSize="modal-lg" modalBody="d-flex flex-column justify-content-center align-items-start align-items-lg-center text-start text-lg-center">
  <span class="badge rounded-pill fw-bold text-pc-light bg-pc-dark py-2 px-3">Success!</span>
  <h2 class="display-6 mb-2 mt-3">Thank you for <span class="text-pc">subscribing!</span></h2>
  <p class="mt-2 mb-3 text-balance">Please check your email to confirm your subscription!</p>
</TheModal> -->

<!-- 
<script is:inline>
function myFunction() {
  const inpObj = document.getElementById("id1");
  if (inpObj.checkValidity() === false) {
    // alert("Please include a valid email address");
  return false;
  } else {
    var modal1 = new bootstrap.Modal(document.getElementById('thankYou')); 
    function showhide() { 
        // show Modal 
        modal1.show(); 
        // hide the modal after 5 seconds 
        setTimeout(() => { 
            modal1.hide(); 
        }, 5000) 
    } 
    showhide();
  }
}
</script> -->